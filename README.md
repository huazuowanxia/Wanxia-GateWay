# Wanxia-Gateway网关
## 简历描述：
> Wanxia-Gateway   
> 项目描述：自研网关，作为微服务接入层，用于管理和控制从客户端到后端服务的所有API请求和流量。基于 Netty 搭建网关核心，使用 AsyncHttpClient 实现全异步链路处理。实现高效的请求转发、流量控制、负载均衡以及服务降级保护等多种功能，确保系统在高负载下的稳定性和灵活性。   
> 我负责的部分：   
> - 针对注册中心与配置中心实现 Nacos 、Zookeeper 多选择，支持动态修改路由配置。   
> - 针对请求构建插拔式动态过滤器链条，实现路由谓词匹配、路由转发、灰度分流等功能。   
> - 实现多种负载均衡策略，如轮询、随机、权重、一致性哈希，支持动态增删实例节点。   
> - 实现网关弹性扩展，支持信号量隔离、线程池隔离、失败重试、熔断保护、降级处理等功能。   
> - 实现了多维度流量控制，如滑动窗口限流、令牌桶限流、漏桶限流，支持动态调整限流策略。   
> - 基于 SPI 允许用户自定义扩展网关功能，如自定义过滤器、限流策略、灰度策略、负载均衡策略、降级策略等。

## 启动项目
1. 环境变量里的JDK需要是JDK17，`java -version`查看当前环境变量的JDK版本
2. 进入到项目根目录(GraceGateway)：`mvn clean install -DskipTests`
3. 项目默认使用nacos作为注册中心和配置中心，需要先启动nacos服务(推荐版本2.2.1，不然可能出现兼容问题)
   > nacos中创建配置，Data ID：gateway-data（和gateway.yaml里的配置一致）   
   > 格式如下：   
   > ```
   > {
   >     "routes": [
   >          {
   >              "id": "user-service-route",
   >              "serviceName": "user-service",
   >              "uri": "/api/user/**"
   >          }
   >      ]
   > }
   > ```
   > 更多配置可以看`pojo.com.wanxia.gateway.config.RouteDefinition`
4. 启动一个或多个下游服务，例如GraceGateway-User，如有需要，可以更改application.yml中的配置
   ```
   cd GraceGateway-User
   mvn clean package spring-boot:run
   ```
5. 启动网关，如GraceGateway-Demo，如有需要，可以更改gateway.yaml中的配置
   ```
   cd GraceGateway-Demo
   mvn clean compile exec:java -Dexec.mainClass="com.grace.gateway.demo.Main"
   ```
   
6 语义缓存
 语义缓存的核心其实就是引入外部的向量大模型，会根据输入来输出对应的维度值。最后我们把输入，维度值，我们下游大模型的回答存入缓存中。
 好处是能够节省成本，返回更快，对于大部分常见形问题都能准确命中缓存。提供是否拼接历史问题来使用缓存
 但是有几点是需要特别关注：
  1. 相似度阈值设置，这个肯定是让用户可以直接配置的，但是用户怎么知道相应的阈值对应的语义近似程度是多少
  2. 缓存过期策略，缓存时间的设置
  3. 缓存容量管理，缓存容量快被占满怎么办，我们需不需要自己去淘汰一些缓存存储的数据
  4. 我们都知道好多问题的答案都是动态的，比如问我们现在黄金的价格，等等实时性比较高的问题肯定会有问题，我们该如何处理 

  1.对于相似度阈值设置，我们提供动态修改，用户可以去测试，先输入一句话，然后根据这句话去输入不同相似度的话语并且动态的调整阈值观察结果
  2.缓存过期策略主要有两种，第一种是